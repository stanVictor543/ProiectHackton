<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificator Imagini</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-dark-theme">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-md-12">

                <div class="card shadow-lg border-0 bg-card-dark">
                    
                    <div class="card-header bg-primary-theme text-white text-center p-4">
                        <h1 class="h3 mb-0">ü§ñ Clasificator: Robo»õi vs. Oameni üë©‚ÄçüöÄ</h1>
                    </div>
                    
                    <div class="card-body p-4 p-md-5">

                        <div class="row g-5 align-items-center">
                            
                            <div class="col-md-6">
                                <h3 class="h4 mb-3 text-light">Panou de Control</h3>

                                <div id="dropZone" class="drop-zone-container">
                                    <input class="form-control" type="file" id="imageUpload" accept="image/jpeg, image/png" hidden>
                                    <label for="imageUpload" class="drop-zone-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16">
                                            <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.52 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2m2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0z"/>
                                        </svg>
                                        <span class="mt-3 fs-5">Trage»õi imaginea aici</span>
                                        <span class="fs-6 text-muted">sau face»õi clic pentru a selecta</span>
                                    </label>
                                </div>

                                <div class="d-grid mt-4">
                                    <button id="classifyBtn" class="btn btn-secondary-theme btn-lg">2. ClasificƒÉ Imaginea</button>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h3 class="h4 mb-3 text-light">Previzualizare & Rezultat</h3>

                                <div id="imagePreviewContainer" class="image-preview-container mb-4 text-center" style="display: none;">
                                    <div class="scan-line"></div>
                                    <img id="imagePreview" src="#" alt="Previzualizare" class="img-fluid rounded shadow-sm" />
                                </div>
                                <div id="noPreview" class="no-preview-box text-center">
                                    <span>A»ôtept imagine...</span>
                                </div>

                                <div id="resultsArea" class="mt-4" style="display: none;">
                                    <div id="resultBox" class="alert alert-info p-3 text-center">
                                        <strong class="fs-4">
                                            <span id="predictedClass">...</span>
                                        </strong>
                                        <br>
                                        <span class="fs-6" id="confidence">...</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- SelectƒÉm elementele DOM o singurƒÉ datƒÉ ---
    const imageUpload = document.getElementById('imageUpload');
    const previewContainer = document.getElementById('imagePreviewContainer');
    const preview = document.getElementById('imagePreview');
    const classifyBtn = document.getElementById('classifyBtn');
    const resultsArea = document.getElementById('resultsArea');
    const resultBox = document.getElementById('resultBox');
    const predictedClassEl = document.getElementById('predictedClass');
    const confidenceEl = document.getElementById('confidence');
    
    // --- Elemente noi pentru Drag & Drop »ôi Preview ---
    const dropZone = document.getElementById('dropZone');
    const noPreview = document.getElementById('noPreview');

    // --- Func»õie centralizatƒÉ pentru gestionarea fi»ôierului ---
    function handleFile(file) {
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                previewContainer.style.display = 'block'; // AratƒÉ containerul de preview
                noPreview.style.display = 'none'; // Ascunde placeholder-ul
                
                // ReseteazƒÉ rezultatele
                resultsArea.style.display = 'none'; 
                resultBox.classList.remove('alert-robot', 'alert-om', 'alert-eroare');
                resultBox.classList.add('alert-info');
            }
            
            reader.readAsDataURL(file);

            // --- TRUC: AsignƒÉm fi»ôierul la input-ul original ---
            // Acest lucru asigurƒÉ cƒÉ logica butonului "classifyBtn" 
            // func»õioneazƒÉ fƒÉrƒÉ modificƒÉri, indiferent dacƒÉ
            // fi»ôierul vine din clic sau din drag-and-drop.
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            imageUpload.files = dataTransfer.files;

        } else {
            alert('VƒÉ rugƒÉm sƒÉ alege»õi un fi»ôier de tip imagine (jpeg, png).');
        }
    }

    // --- 1. Logica pentru Drag & Drop ---
    dropZone.addEventListener('dragover', (event) => {
        event.preventDefault(); // Necesar pentru a permite drop
        dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (event) => {
        event.preventDefault();
        dropZone.classList.remove('drag-over');
        
        const file = event.dataTransfer.files[0];
        handleFile(file);
    });

    // --- 2. Logica pentru input-ul de fi»ôier (la clic) ---
    imageUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        handleFile(file);
    });

    // --- 3. Logica pentru trimiterea imaginii la backend (API Fetch) ---
    // (ModificatƒÉ pentru a include anima»õia de scanare)
    classifyBtn.addEventListener('click', async function() {
        
        const file = imageUpload.files[0];

        if (!file) {
            alert('VƒÉ rugƒÉm sƒÉ alege»õi o imagine mai √Ænt√¢i.');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        // Afi»ôƒÉm un status de "loading" »ôi dezactivƒÉm butonul
        classifyBtn.disabled = true;
        classifyBtn.textContent = 'Se clasificƒÉ...';
        resultsArea.style.display = 'none';
        resultBox.classList.remove('alert-robot', 'alert-om', 'alert-eroare');
        resultBox.classList.add('alert-info');

        // --- START ANIMA»öIE SCANARE ---
        previewContainer.classList.add('is-scanning');

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.error) {
                throw new Error(data.error);
            }

            // Afi»ôƒÉm rezultatul
            predictedClassEl.textContent = data.predicted_class;
            confidenceEl.textContent = `Confiden»õƒÉ: ${(data.confidence * 100).toFixed(2)}%`;
            
            resultBox.classList.remove('alert-info');
            if (data.predicted_class === 'robot') {
                resultBox.classList.add('alert-robot');
            } else {
                resultBox.classList.add('alert-om');
            }
            resultsArea.style.display = 'block';

        } catch (error) {
            console.error('Eroare la clasificare:', error);
            predictedClassEl.textContent = 'Eroare';
            confidenceEl.textContent = error.message;
            
            resultBox.classList.remove('alert-info');
            resultBox.classList.add('alert-eroare');
            resultsArea.style.display = 'block';
        
        } finally {
            // ReactivƒÉm butonul
            classifyBtn.disabled = false;
            classifyBtn.textContent = '2. ClasificƒÉ Imaginea';

            // --- STOP ANIMA»öIE SCANARE ---
            previewContainer.classList.remove('is-scanning');
        }
    });
</script>
</body>
</html>